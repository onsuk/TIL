# CIS194 - Week 8

## IO

### The problem with purity

하스켈은 lazy하기 때문에 pure하다. 이것은 중요한 두가지를 의미한다.
1. 함수는 함수 이외의 것으로 인한 어떠한 영향이 없어야 한다. (ex. 함수는 화면에 출력하면 안된다.) 함수는 함수 자체의 결과값**만** 계산해야 한다.
2. 함수는 외부의 도구에 의존적이지 않아야 한다. (ex. 함수는 키보드 입력이나 파일/네트워크 입력을 받을 수 없다.) 함수는 함수 자체의 입력(*인자*)에**만** 의존적이어야 한다. 즉, 함수는 같은 입력값에 대해서는 같은 출력을 반환해야 한다.

하지만 이러한 도구들을 사용하고 싶을 때가 있다! 만약 Haskell으로 할 수 있는 것이 단순히 ghci를 통해 계산하는 함수를 하는 것이 전부라면, 학문적으로는 흥미로울 수 있으나 전혀 실용적이지 않을 것이다.

사실 Haskell로 이러한 것들을 하는 것은 가능하다. 하지만 다른 언어들과 매우 달라 보인다.

### The IO type

문제의 해답은 `IO`라 부르는 특별한 타입이다. `IO a` 타입의 값들은 효과적인 계산에 대한 서술이다. 가능한 경우 I/O 연산을 실행하거나, 결국 `a`라는 타입의 값을 생성한다. `IO a` 타입의 값은 그 자체로 어떠한 효과에 대해서 안전하다. 이것은 효과적인 계산에 대한 서술일 뿐이다. 이것에 대해 생각해볼 수 있는 방법 중 하나는 **first-class** 명령형 프로그래밍이다.

아래 그림과 같이, 우리가 아래와 같은 코드를 갖고 있다고 가정해보자.

```haskell
c :: Cake

```

평범하고 단순한 맛있는 케이크를 갖게 되었다.

![](img/cake.jpg)

반대로 우리가 레시피를 갖고 있다고 가정해보자.

```haskell
r :: Recipe Cake
```

레시피를 갖게 되었다. 케이크를 어떻게 만드는지에 대한 설명이 적혀있는 종이조각 말이다.

![](img/recipe.gif)

실제로 케이크를 갖고 있는 것뿐만 아니라, 레시피까지 갖고 있다는 것은 다른 어떠한 것에 영향을 미치지 않는다. 단순히 레시피가 손 안에 있다는 것만으로, 오븐이 가열되거나 밀가루가 계량되어지거나 하는 일은 없다. 케이크를 만드는 것은 레시피대로 **행해져야** 한다. (밀가루가 덜어지거나, 재료가 혼합되거나 오븐이 가열되는 것 등 말이다.)

이와 같이 `IO a` 타입의 값은 그저 `a` 타입의 값을 만드는 **레시피**일 뿐이다. (그리고 이에 따라 조금의 영향이 있을 수 있다.) 다른 값들과 같이 인자로 전달될 수 있으며 함수의 결과값으로 반환될 수 있고, data structure에 저장될 수 있다. 그리고 (곧 보게 될테지만) 다른 `IO` 값들과 결합해서 더욱 복잡한 레시피를 만들 수도 있다.

그렇다면 `IO` 타입의 값은 어떻게 실행될까? 단 한가지 방법이 있다. Haskell 컴파일러가 아래와 같은 특별한 값을 찾는다.

```haskell
main :: IO ()
```

위 코드를 통해 런타임으로 전달되고 실행된다. 그게 전부다! Haskell 런타임에 대해 생각하기를, 요리를 할 수 있는 마스터 셰프라고 보면 된다. 물론 `main`은 더 복잡할 수 있으며 많은 작은 `IO` 계산들로 구성될 수 있다.

자 이제 작성해보자! 우리는 다음과 같은 함수를 쓸 수 있다.

```haskell
putStrLn :: string -> IO ()
```

이 함수는 `String`을 받게 되면 **(실행될 때) 화면에 해당 `String`을 출력하는 `IO` 계산**을 반환한다. 그래서 우리는 `Hello.hs`에서 간단히 다음과 같이 함수를 가져다 쓸 수 있다.

```haskell
module Hello where

main = putStrLn "Hello Onsuk!"
```

그리고 명령 프롬프트에서 `runhaskell Hello.hs` 명령어를 입력하면 화면에 메시지가 출력된다.

> 난 **stack**을 사용했기 때문에 `stack runghc Hello.hs`을 입력하면 된다.

혹은 `ghc --make Hello.hs`를 사용하면 Hello(윈도우에서는 Hello.exe)라는 실행 가능한 파일을 얻을 수 있다.
