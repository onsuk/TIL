# 로킹(Locking)
데이터베이스에서의 **로킹(Locking) 단위**란 말 그대로 '잠그는 단위'를 말한다. **로킹 기법**이란 하나의 토랜잭션이 데이터를 액세스하는 동안 다른 트랜잭션이 그 데이터 항목을 액세스할 수 없도록 하는 병행 제어 기법이며, 로크는 사용하는 데이터 객체이다.

즉, **한 번에 한 명만 사용할 수 있게 하는 단위를 '로킹 단위'라고 하는 것**이다.

예를 들어, 어떤 프로젝트의 소스를 여러 사람이 동시에 작업할 경우 파일이 꼬일 수도 있다. 그래서 누군가가 특정 파일을 건들고 있을 때, 다른 사용자는 그 파일을 건들지 못하도록 하는 것이 **로킹**이다. 그리고 이 경우에는 **로킹 단위가 파일**이 된다.

더 높은 안전성을 위해서, 어떤 사람이 어떤 폴더에 있는 파일을 작업하고 있을 때, 다른 사람으로 하여금 그 폴더에 아예 접근을 못 하게 하는 방법도 있다. 이렇게 하면 **로킹 단위가 폴더**가 된다. 더 나아가, 프로젝트에 접근조차 못하게 할 수 있는데, 이 때는 **로킹 단위가 프로젝트**가 된다.

데이터베이스 트랜잭션에서 로킹 단위는 파일, 레코드, 필드와 같이 여러가지로 나누어 질 수도 있다.

## 2단계 로킹 규약(Two-Phase Locking Protocol)
락(lock)을 걸고 해제하는 시점에 제한을 두지 않으면 두 개의 트랜잭션이 동시에 실행될 때 데이터의 일관성이 깨질 수 있어서 **로킹 단계를 2개로 구분**하여 이를 방지하는 방법

![](http://www.jidum.com/upload/ckeditor/2016/07/2016072517231148.png)

- 확장 단계(Growing Phase) - 트랜잭션은 새로운 lock 연산만 할 수 있고, unlock 연산은 할 수 없는 단계
- 축소 단계(Shrinking Phase) - 트랜잭션은 unlock 연산만 실행할 수 있고, lock 연산으 실행할 수 없는 단계

> 2단계 로킹 규약은 직렬 가능성을 보장할 수 있지만 교착상태(deadlock)에 빠질 수 있기 때문에 이에 대한 해결이 필요하다.

# Reference
https://raisonde.tistory.com/entry/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EB%A1%9C%ED%82%B9Locking-%EA%B8%B0%EB%B2%95%EA%B3%BC-%EB%A1%9C%ED%82%B9-%EB%8B%A8%EC%9C%84
https://mangkyu.tistory.com/30
http://www.jidum.com/jidums/view.do?jidumId=284